(function(){function Da(){q={x:m/8,y:0.85*h,move:null,button:null}}function ja(){var a=f,c={x:IPX+O,y:IPY+O,z:IPZ+O,a:0,ea:0,e:0,f:20,h:20,d:20,k:W,j:W,l:20,g:Ta,color:oa,face:"\uff61\u25d5  \u25d5\uff61",M:"\u203f",N:-5,O:5,update:Ua};for(k in c)a[k]=c[k];v(f);fa=f.b-0.5*m;ga=f.c-0.7*h}function Ea(a){e.save();-1E7<a.i&&(e.setTransform(1,0,0,0.3,a.b+a.l-4-A,a.c-a.i+a.z+2*a.l-1-OffsetY),e.beginPath(),e.arc(0,0,a.l,0,u),e.fillStyle=Va,e.fill());e.setTransform(1,0,0,1,a.b+a.l-A,a.c+a.l-OffsetY);e.lineWidth=
1;e.strokeStyle="#111";e.fillStyle=a.color;e.beginPath();e.arc(0,0,a.l,0,u);e.fill();e.scale(0>a.a?1:-1,1);e.fillStyle="#222";e.fillText(a.face,-15,1);e.fillText(a.M,a.N,a.O);e.stroke();e.restore()}function Ta(){Ea(f)}function Ua(a){var c=a.left,b=a.right,d=a.s;a.a=c?a.a-0.15:b?a.a+0.15:0.9*a.a;var g=2.5+d;$(a.a)>g&&(c?a.a=pa(0.95*a.a,-g):b&&(a.a=qa(0.95*a.a,g)));a.x+=a.a;a.e-=0.2;a.z+=a.e;0<a.e&&(g=ra(a.x,a.y,a.z,20,sa))&&(Fa.play(),a.z-=a.e,a.e*=-0.8);-2E3>a.z&&ja();g=ta(a.x,a.y,a.z,20);a.i=-Infinity;
g.d&&(a.i=g.z+O,a.z<=a.i||d&&5>a.z-a.i&&2>$(a.e))&&(-2>a.e||d?Wa.play():-1>a.e&&Xa.play(),a.z=a.i,a.e=d?qa($(a.e/2),6):qa($(a.e/2),$(a.a)/1.5));if(g=ra(a.x,a.y,a.z,20,0<a.a?P:aa))a.x-=a.a,Fa.play(),a.a=10<a.z-a.i?-0.2*a.a:-0.8*a.a;v(a);a.b-=O;a.c-=O/2;if(c||b)fa=a.b-m*(0.5-a.a/20);ga=a.c-0.7*h}function Ga(a){f.s=1;q.button=a;p.clearRect(m/2,0,m/2,h);p.beginPath();p.arc(a[1],a[2],35,0,u);p.fill()}function Ha(a){q.move=a;var c=a[1];a=a[2];p.clearRect(0,0,m/2,h);p.beginPath();p.arc(q.x,q.y,20,0,u);p.moveTo(q.x,
q.y);p.lineTo(c,a);p.arc(c,a,35,0,u);p.stroke();p.fill();c<q.x-15?(f.left=1,f.right=0):c>q.x+15?(f.left=0,f.right=1):(f.left=0,f.right=0)}function Ya(a){Ea(a)}function Za(a){a.x+=a.a;a.e-=0.2;a.z+=a.e;ra(a.x,a.y,a.z,22,0<a.a?P:aa)&&(a.x-=a.a,a.a*=-1);var c=ta(a.x,a.y,a.z,22);c!=a.floor?(a.x-=a.a,a.a*=-1):(a.i=c.z+11,a.z<=a.i&&(a.z=a.i,a.e=2));v(a);a.b-=11;a.c-=5.5;a.b+a.k-10>=f.b&&a.b+10<f.b+f.k&&a.c+a.j-10>=f.c&&a.c+10<f.c+f.j&&(180<t-F&&(C=0),G[C++].play(),C%=G.length,F=t,ja())}function $a(a){a.I.g(0,
0,a.n,a.o);Ia(a)}function ab(a){var c=a.n,b=a.o,d=a.D,g=a.B,w=a.w;e.fillStyle=a.C;e.fillRect(0,0,c,b);e.strokeStyle=d;d=0;e.lineWidth=w/5;y0=0;y1=w;for(e.beginPath();y1<=b;){d++;e.moveTo(0,y1);e.lineTo(c,y1);for(x0=d&1?g:g/2;x0<c;)e.moveTo(x0,y0),e.lineTo(x0,y1),x0+=g;y0=y1;y1+=w}e.stroke();Ia(a)}function Ia(a){var c=a.A,b=a.n,d=a.o;c&15&&(e.strokeStyle=a.v,e.beginPath(),c&1&&(e.moveTo(0,0),e.lineTo(b,0)),c&2&&(e.moveTo(b,0),e.lineTo(b,d)),c&4&&(e.moveTo(b,d),e.lineTo(0,d)),c&8&&(e.moveTo(0,d),e.lineTo(0,
0)),e.stroke())}function Ja(a,c,b,d,g){var w=[],e=c+d,f=b+g;s(a,function(a){a.b+a.k>=c&&a.b<=e&&a.c+a.j-a.d/2>=b&&a.c-a.d/2<=f&&w.push(a)});return w}function bb(a){var c=I.indexOf(a.id);-1!=c?c<I.length-1&&(I.splice(c,1),I.push(a.id)):(I.length>=Ka&&(c=I.shift(),Q("Removing from cache cube "+c),delete ua[c]),I.push(a.id),c=R(a.k,a.j,function(b){var c=e;e=b;a.Z(a);e=c}),Q("Adding to cache cube "+a.id+"  X:"+a.x+" Y:"+a.y+" Z:"+a.z+" W:"+a.h+" H:"+a.f+" D:"+a.d),ua[a.id]=c);ua[a.id].g(a.b,a.c-a.d/2,
a.k,a.j)}function cb(a){a.F&&(e.setTransform(1,0,0,1,0,a.d/2),a.F.g(a.F));a.top&&(e.setTransform(1,0,-0.5,0.5,0.4+a.d/2,0),a.top.g(a.top));a.right&&(e.setTransform(0.5,-0.5,0,1,a.h,a.d/2),a.right.g(a.right))}function ta(a,c,b,d){var g={z:-1E10};s(va,function(w){w.z>g.z&&b+d>w.z&&a+d>w.x&&a<w.x+w.h&&c+d>w.y&&c<w.y+w.d&&(g=w)});return g}function ra(a,c,b,d,g){return db(g,function(g){if(a+d>g.x&&a<g.x+g.h&&c+d>g.y&&c<g.y+g.d&&b+d>g.z&&b<g.z+g.f)return g})}function v(a){a.b=a.x+a.y/2;a.c=h-a.y/2-a.f-
a.z}function wa(a){var c=e.createPattern(R(3*n,3*n,function(b){b.drawImage(a,0,0,3*n,3*n)}),"repeat");c.g=function(a,c,g,f){e.fillStyle=this;e.fillRect(a,c,g,f)};return c}function xa(a,c,b,d,g,e,f,n,m){c=a.createImageData(c,b);b=c.data;for(var p=0;p<b.length;p+=4){var h=b,q=p,eb=d+S()*g,s=e+S()*f,l=n+S()*m;h[q]=eb;h[q+1]=s;h[q+2]=l;h[q+3]=255}a.putImageData(c,0,0)}function fb(){var a,c;for(c=0;c<D.length;c++)a=D[c],a.b>=f.b&&a.b<f.b+W&&a.c>=f.c&&a.c<f.c+W?(180<t-F&&(C=0),D.splice(c,1),c--,G[C++].play(),
C%=G.length,F=t):e.drawImage(ya[(t+a.Q)%ya.length],a.b-J/2,a.c-J/2)}function ba(a){za.p.V(a);var c=za.X();a=new Uint8Array(4*((c+1)/2|0)+44);var c=2*za.W(new Uint16Array(a.buffer,44),c),b=new Uint32Array(a.buffer,0,44);b[0]=1179011410;b[1]=c+36;b[2]=1163280727;b[3]=544501094;b[4]=16;b[5]=65537;b[6]=44100;b[7]=88200;b[8]=1048578;b[9]=1635017060;b[10]=c;for(var c=c+44,b=0,d="data:audio/wav;base64,";b<c;b+=3)var g=a[b]<<16|a[b+1]<<8|a[b+2],d=d+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[g>>
18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[g>>12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[g>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[g&63]);b-=c;a=new Audio;a.src=d.slice(0,d.length-b)+"==".slice(0,b);return a}function Q(a){DEBUG||alert("Forgot a log");console.log(a)}function La(a,c){for(var b=[],d=0;d<a.length;d++)b[d]=a[d];for(k in c)b[k]=c[k];return b}function K(a,c,b,d){return"rgba("+a+","+c+","+b+","+(d||
1)+")"}function R(a,c,b){var d=L.createElement("canvas");d.width=a;d.height=c;b(d.getContext("2d"),d);d.g=function(a,b,c,d){e.drawImage(this,a,b,c,d)};return d}function db(a,c){return gb(a.length,function(b){return c(a[b],b)})}function gb(a,c){var b;b=b||1;for(var d=0;d<a;d+=b){var g=c(d);if(g)return g}}function Aa(a,c){var b;b=b||1;for(var d=0;d<a;d+=b)c(d)}function s(a,c){for(var b=0;b<a.length;b++)c(a[b],b)}function hb(){this.V=function(a){for(var c=0;24>c;c++)this[String.fromCharCode(97+c)]=a[c]||
0;0.01>this.m&&(this.m=0.01);a=this.q+this.m+this.r;0.18>a&&(a=0.18/a,this.q*=a,this.m*=a,this.r*=a)}}function Ma(){t++;ca=0.9*ca+0.1*fa;A=Na(ca);T=0.9*T+0.1*ga;OffsetY=Na(T);e.setTransform(1,0,0,1,0-A,0-OffsetY);e.clearRect(A,OffsetY,m,h);var a=Ja(da,A-m/2,OffsetY-h/2,2*m,2*h);f.update(f);s(a,function(a){a.update&&a.update(a)});Ba=Ja(a,A,OffsetY,m,h);DEBUG&&Ba.length>Ka&&Q("too many sprites in screen to fit in cache");var c=[],b=[];s(Ba,function(a){var g;f.y+f.d<=a.y+3||a.z+a.f<=f.z+3||a.x+a.h<=
f.x+3?g=!0:a.y+a.d<=f.y+3||f.z+f.f<=a.z+3||f.x+f.h<=a.x+3?g=!1:(Q("cubes intersection: "),g=null);g?c.push(a):b.push(a)});s(c,function(a){a.g(a)});f.g();s(b,function(a){e.globalAlpha=a.b-10<f.b+f.k&&a.b+10+a.k>f.b&&a.y+a.d<f.y&&a.c-10<f.c+f.j&&a.c+10+a.j>f.c?0.3:1;a.g(a)});e.globalAlpha=1;fb();M(Ma)}DEBUG=!1;var L=document,z=[];s(["b","c","d"],function(a){z.push(L.getElementById(a))});var m=z[0].width,h=z[0].height,Oa=z[1].getContext("2d"),e=Oa,Pa=z[0].getContext("2d"),p=z[2].getContext("2d"),S=Math.random,
$=Math.abs,pa=Math.min,qa=Math.max,Na=Math.round,u=2*Math.PI,D=[],da=[],q=0,s=function(a,c){for(var b=0;b<a.length;b++)c(a[b],b)},M=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame;if(!M)var Qa=0,M=function(a){var c=(new Date).getTime(),b=Math.max(0,16-(c-Qa));window.setTimeout(function(){a()},b);Qa=c+b};var ca,T,A=OffsetY=0,Ra=K(15,15,15,0.3);BW=27;BH=0;B=4095;BC=Ra;var za=new function(){this.p=new hb;var a,c,b,d,g,e,f,n,m,p,h,q;this.reset=function(){var a=
this.p;d=100/(a.T*a.T+0.001);g=100/(a.J*a.J+0.001);e=1-0.01*a.f*a.f*a.f;f=1E-6*-a.K*a.K*a.K;a.S||(h=0.5-a.ba/2,q=5E-5*-a.ca);n=0<a.t?1-0.9*a.t*a.t:1+10*a.t*a.t;m=0;p=1==a.L?0:2E4*(1-a.L)*(1-a.L)+32};this.X=function(){this.reset();var d=this.p;a=1E5*d.q*d.q;c=1E5*d.m*d.m;b=1E5*d.r*d.r+10;return a+c+b|0};this.W=function(s,y){var l=this.p,z=1!=l.u||l.R,v=0.1*l.R*l.R,A=1+3E-4*l.h,u=0.1*l.u*l.u*l.u,C=1+1E-4*l.Q,I=1!=l.u,N=l.x*l.x,O=l.J,G=l.G||l.H,R=0.2*l.H*l.H*l.H,D=l.G*l.G*(0>l.G?-1020:1020),J=l.P?(2E4*
(1-l.P)*(1-l.P)|0)+32:0,W=l.d,Q=l.aa/2,ba=0.01*l.U*l.U,K=l.S,L=a,da=1/a,fa=1/c,ga=1/b,l=5/(1+20*l.Y*l.Y)*(0.01+u);0.8<l&&(l=0.8);for(var l=1-l,P=!1,aa=0,ka=0,la=0,F=0,ha=0,ma,ia=0,x,U=0,ea,S=0,r,ca=0,V,T=0,M=Array(1024),na=Array(32),E=M.length;E--;)M[E]=0;for(E=na.length;E--;)na[E]=2*Math.random()-1;for(E=0;E<y;E++){if(P)return E;J&&++ca>=J&&(ca=0,this.reset());p&&++m>=p&&(p=0,d*=n);e+=f;d*=e;d>g&&(d=g,0<O&&(P=!0));x=d;0<Q&&(T+=ba,x*=1+Math.sin(T)*Q);x|=0;8>x&&(x=8);K||(h+=q,0>h?h=0:0.5<h&&(h=0.5));
if(++ka>L)switch(ka=0,++aa){case 1:L=c;break;case 2:L=b}switch(aa){case 0:la=ka*da;break;case 1:la=1+2*(1-ka*fa)*W;break;case 2:la=1-ka*ga;break;case 3:la=0,P=!0}G&&(D+=R,ea=D|0,0>ea?ea=-ea:1023<ea&&(ea=1023));z&&A&&(v*=A,1E-5>v?v=1E-5:0.1<v&&(v=0.1));V=0;for(var ja=8;ja--;){U++;if(U>=x&&(U%=x,3==K))for(ma=na.length;ma--;)na[ma]=2*Math.random()-1;switch(K){case 0:r=U/x<h?0.5:-0.5;break;case 1:r=1-2*(U/x);break;case 2:r=U/x;r=6.28318531*(0.5<r?r-1:r);r=0>r?1.27323954*r+0.405284735*r*r:1.27323954*r-
0.405284735*r*r;r+=0.225*(r*$(r)-r);break;case 3:r=na[Math.abs(32*U/x|0)]}z&&(ma=ia,u*=C,0>u?u=0:0.1<u&&(u=0.1),I?(ha+=(r-ia)*u,ha*=l):(ia=r,ha=0),ia+=ha,F+=ia-ma,r=F*=1-v);G&&(M[S%1024]=r,r+=M[(S-ea+1024)%1024],S++);V+=r}V=0.125*V*la*N;s[E]=1<=V?32767:-1>=V?-32768:32767*V|0}return y}},Sa=[0,,0.14,0.445,0.4616,0.6,,,,,,0.587,0.5406,,,,,,1,,,,,0.45],G=[];Aa(5,function(a){G.push(ba(La(Sa,{5:0.6+0.05*a})))});Aa(4,function(a){G.push(ba(La(Sa,{5:0.8-0.05*a})))});var C=0,F=0,J=80,ya=[];Aa(128,function(a){var c=
$(Math.sin(u*a/128));0.1<c&&ya.push(R(J,J,function(b){b.strokeStyle="#aa6";b.shadowBlur=30;b.lineWidth=2;b.shadowColor="#ff2";b.beginPath();b.setTransform(c,0,0,1,J/2,J/2);b.fillStyle="#fe4";b.arc(0,0,10,0,u);b.fill();b.fillStyle="#aa6";63<a?b.fillText("1",-3,3.5):b.fillText("\u265b",-5,3.5);b.stroke()}))});var n=20,ib=R(n,n,function(a){xa(a,n,n,80,20,180,40,80,40)}),jb=R(n,n,function(a){xa(a,n,n,120,20,110,20,40,30)}),kb=R(n,n,function(a){xa(a,n,n,140,25,120,25,50,40)}),lb=wa(ib),mb=wa(jb),nb=wa(kb),
fa=0,ga=0,P=[],aa=[],va=[],sa=[],ua={},I=[],ob=0,Ka=50,Ca=e.createRadialGradient(15,-9,3,15,-9,32);Ca.addColorStop(0,"#FFD6CE");Ca.addColorStop(1,"#B34C80");var y={};L.addEventListener("keydown",function(a){y[a.keyCode]=1;f.left=y[37];f.right=y[39];f.da=y[38];f.$=y[40];f.s=y[32]});L.addEventListener("keyup",function(a){y[a.keyCode]=0;f.left=y[37];f.right=y[39];f.s=y[32]});L.body.addEventListener("touchmove",function(a){a.preventDefault()},!1);p.fillStyle=K(140,150,240,0.5);p.shadowColor=K(170,180,
250,0.5);p.shadowBlur=30;p.lineWidth=7;p.strokeStyle=K(80,90,140,0.5);var N=z[2];N.addEventListener("touchstart",function(a){var c=null,b=null;s(a.changedTouches,function(a){var g=a.clientX-N.offsetLeft,e=a.clientY-N.offsetTop;g<m/2-20?c=[a.identifier,g,e]:g>m/2+20&&(b=[a.identifier,g,e])});null!=c&&Ha(c);null!=b&&Ga(b)});N.addEventListener("touchmove",function(a){var c=null,b=null;s(a.changedTouches,function(a){var g=a.clientX-N.offsetLeft,e=a.clientY-N.offsetTop;g<m/2-20?c=[a.identifier,g,e]:g>
m/2+20&&(b=[a.identifier,g,e])});null!=c&&Ha(c);null!=b&&Ga(b)});N.addEventListener("touchend",function(a){s(a.changedTouches,function(a){null!=q.move&&a.identifier==q.move[0]&&(q.move=null,f.left=0,f.right=0,p.beginPath(),p.clearRect(0,0,m/2,h),p.arc(q.x,q.y,30,0,u),p.fill());null!=q.button&&a.identifier==q.button[0]&&(q.button=null,f.s=0,p.clearRect(m/2,0,m/2,h))})});var oa=e.createRadialGradient(12,-7,3,12,-7,28);oa.addColorStop(0,"#8ED6FF");oa.addColorStop(1,"#004CB3");var W=40,O=W/4,Wa=ba([0,
,0.1453,,0.225,0.3726,,0.12,0.22,,,,,0.1547,,,,,1,,,,,0.35]),Xa=ba([0,,0.1,,0.22,0.3726,,0.14,0.2,,,,0.12,0.1547,,,,,1,,,,,0.26]),Fa=ba([0,,0.11,0.16,0.09,0.227,0.04,-0.18,0.34,,,,,0.23,0.12,,,,1,0.2,0.16,0.1,,0.32]),Va=K(15,15,15,0.5),f={};Da();(function(a){da=[];D=[];P=[];aa=[];va=[];sa=[];IPX=A=OffsetY=0;IPY=50;IPZ=0;BW=27;BC=Ra;B=4095;Y=0;n=100;for(var c=0;c<a.length;){var b=a[c++];switch(b){case 0:IPX=a[c++];IPZ=a[c++];ja();break;case 1:var b=a[c++],d=a[c++],e=IPY,f;f=0+100*S();b={x:b,z:d,y:e,
f:10,Q:f<<0};v(b);D.push(b);break;case 2:b=a[c++];d=a[c++];b={x:b+11,y:IPY+11,z:d+11,f:44,a:-1,e:0,f:22,h:22,d:22,k:44,j:44,l:22,g:Ya,update:Za,color:Ca,face:"\u25d5` \u141f\u25d5 \u30ce",M:"\u2054",N:-8,O:9};v(b);b.floor=ta(b.x+11,b.y+11,b.z+11,22);DEBUG&&!b.floor&&alert("Enemy must be above floor");da.push(b);break;case 3:case 4:DR=3==b?ab:$a;b=a[c++];d=a[c++];e=a[c++];f=a[c++];var h=b,p=d,m=e,q=f;BH=BH||0.3*BW;h={x:h,y:Y,z:p,h:m,f:q,d:n,k:m+n/2,j:q+n/2,Z:cb,g:bb};v(h);0<m&&0<q&&(h.F={C:"#d74",
D:"#dc8",I:mb,n:m,o:q,B:BW,w:BH,v:BC,A:B,g:DR[0]||DR});0<n&&0<q&&(h.right={C:"#b52",D:"#ba6",I:nb,n:n,o:q,B:BW,w:BH,v:BC,A:B>>4,g:DR[1]||DR});0<m&&0<n&&(h.top={C:"#e86",D:"#eda",I:lb,n:m,o:n,B:BW,w:BH,v:BC,A:B>>8,g:DR[2]||DR});h.id=ob++;da.push(h);Y+n<IPY||Y>IPY||(16<n&&16<f&&(P.push({y:Y,z:d,d:n,f:f,h:0,x:b}),aa.push({y:Y,z:d,d:n,f:f,h:0,x:b+e})),16<n&&16<e&&(va.push({x:b,y:Y,h:e,d:n,f:0,z:d+f}),sa.push({x:b,y:Y,h:e,d:n,f:0,z:d})));break;case 5:Y=a[c++];n=a[c++];break;default:Q("Error loading level at index "+
c+"  type: "+b)}}})([5,90,10,3,299,-240,20,125,3,661,-318,20,121,3,332,-319,20,58,3,1480,-229,20,84,5,0,100,4,80,-354,614,34,4,449,-322,141,71,3,187,-88,174,16,0,149,-247,1,208,-33,1,260,-50,1,315,-30,3,217,-252,141,12,1,589,-222,2,547,-221,3,391,-182,141,28,4,770,-383,462,34,3,802,-256,111,28,3,914,-349,171,219,1,798,-303,1,850,-320,1,836,-286,1,882,-326,1,819,-320,1,872,-300,1,1132,-160,1,1184,-162,1,1236,-163,1,1184,-190,1,1160,-162,1,1211,-163,1,1185,-214,1,1186,-238,1,1188,-262,1,1177,-286,1,
1152,-291,1,1134,-271,4,1279,-383,259,42,1,1313,-175,1,1364,-151,1,994,-45,1,1316,-202,1,1336,-155,1,1386,-168,1,1338,-226,1,1360,-243,1,1379,-271,1,1361,-292,1,1330,-296,1,1304,-277,2,1022,-87,4,1430,-342,141,110,3,1404,-133,111,28,3,1185,-80,168,28,3,1544,-231,53,65,1,1231,38,1,1232,13,1,1233,-11,1,1233,-34,1,1278,63,1,1335,57,1,1307,62,1,1297,16,1,1318,30,1,1324,-35,1,1339,-11,1,1324,4,1,1298,-40,1,1273,-27,1,1231,63,3,627,-166,150,12,3,1215,-261,87,20,5,0,10,3,246,-322,50,70,3,476,-251,27,70,
3,1441,-231,20,97]);onresize=function(){var a=z[0].parentElement,c=m,b=h;m=pa(960,a.offsetWidth);h=pa(760,a.offsetHeight);var d=a.offsetTop+(a.offsetHeight-h)/2+"px",e=a.offsetLeft+(a.offsetWidth-m)/2+"px";s(z,function(a){a.style.top=d;a.style.left=e;if(c!=m||b!=h)a.width=m,a.height=h});Pa.fillStyle="#222";Pa.fillRect(0,0,m,h);if(c!=m||b!=h)s(D,function(a){v(a)}),s(da,function(a){v(a)}),Da()};onresize();ca=fa=f.b-0.5*m;T=ga=f.c-0.8*h;e=Oa;t=0;var Ba=[];M(Ma)})();

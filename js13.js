(function(){function Ha(){s={x:p/8,y:0.85*m,move:null,button:null}}function pa(){var a=e,c={x:IPX+R,y:IPY+R,z:IPZ+R,a:0,ca:0,e:0,f:20,h:20,d:20,k:D,j:D,l:20,g:$a,color:qa,face:"\uff61\u25d5  \u25d5\uff61",M:"\u203f",N:-5,O:5,update:ab};for(k in c)a[k]=c[k];w(e);ha=e.b-0.5*p;S=e.c-0.7*m}function Ia(a){if(-1E7<a.i){var c=a.c-a.i+a.z;d.save();d.setTransform(1,0,0,0.3,a.b+a.l-4-J,c+2*a.l-1-OffsetY);d.beginPath();d.arc(0,0,a.l,0,C);d.fillStyle=bb;d.fill()}d.setTransform(1,0,0,1,a.b+a.l-J,a.c+a.l-OffsetY);
d.lineWidth=1;d.strokeStyle="#111";d.fillStyle=a.color;d.beginPath();d.arc(0,0,a.l,0,C);d.fill();d.scale(0>a.a?1:-1,1);d.fillStyle="#222";d.fillText(a.face,-15,1);d.fillText(a.M,a.N,a.O);d.stroke();d.restore()}function $a(){Ia(e)}function ab(a){var c=a.left,b=a.right,f=a.s;a.a=c?a.a-0.15:b?a.a+0.15:0.9*a.a;var u=2.5+f;aa(a.a)>u&&(c?a.a=ra(0.95*a.a,-u):b&&(a.a=sa(0.95*a.a,u)));a.x+=a.a;a.e-=0.2;a.z+=a.e;H=D;0<a.e&&(u=ta(a.x,a.y,a.z,20,Ja))&&(Ka.play(),a.z-=a.e,a.e*=-0.8);-2E3>a.z&&pa();u=ua(a.x,a.y,
a.z,20);a.i=-Infinity;u.d&&(a.i=u.z+R,a.z<=a.i||f&&5>a.z-a.i&&2>aa(a.e))&&(-2>a.e||f?cb.play():-1>a.e&&db.play(),a.z=a.i,a.e=f?sa(aa(a.e/2),6):sa(aa(a.e/2),aa(a.a)/1.5));if(u=ta(a.x,a.y,a.z,20,0<a.a?va:wa))a.x-=a.a,Ka.play(),a.a=10<a.z-a.i?-0.2*a.a:-0.8*a.a;w(a);a.b-=R;a.c-=R/2;if(c||b)ha=a.b-p*(0.5-a.a/20);S=a.c-0.7*m}function La(a){e.s=1;s.button=a;q.clearRect(p/2,0,p/2,m);q.beginPath();q.arc(a[1],a[2],35,0,C);q.fill()}function Ma(a){s.move=a;var c=a[1];a=a[2];q.clearRect(0,0,p/2,m);q.beginPath();
q.arc(s.x,s.y,20,0,C);q.moveTo(s.x,s.y);q.lineTo(c,a);q.arc(c,a,35,0,C);q.stroke();q.fill();c<s.x-15?(e.left=1,e.right=0):c>s.x+15?(e.left=0,e.right=1):(e.left=0,e.right=0)}function eb(a){Ia(a)}function fb(a){a.x+=a.a;a.e-=0.2;a.z+=a.e;ta(a.x,a.y,a.z,v,0<a.a?va:wa)&&(a.x-=a.a,a.a*=-1);var c=ua(a.x,a.y,a.z,v);c!=a.floor?(a.x-=a.a,a.a*=-1):(a.i=c.z+z,a.z<=a.i&&(a.z=a.i,a.e=2));w(a);a.b-=z;a.c-=z/2;a.b+a.k>=e.b&&a.b<e.b+e.k&&a.c+a.j>=e.c&&a.c<e.c+e.j&&(180<t-ba&&(E=0),K[E++].play(),E%=K.length,ba=t,
pa())}function Na(a,c){var b={x:a+z,y:IPY+z,z:c+z,f:L,a:-1,e:0,f:v,h:v,d:v,k:L,j:L,l:v,g:eb,update:fb,color:xa,face:"\u25d5` \u141f\u25d5 \u30ce",M:"\u2054",N:-8,O:9};w(b);b.floor=ua(b.x+z,b.y+z,b.z+z,v);DEBUG&&!b.floor&&alert("Enemy must be above floor");T.push(b)}function ya(a){a.I.g(0,0,a.n,a.o);Oa(a)}function ca(a){var c=a.n,b=a.o,f=a.D,u=a.B,e=a.w;d.fillStyle=a.C;d.fillRect(0,0,c,b);d.strokeStyle=f;f=0;d.lineWidth=e/5;y0=0;y1=e;for(d.beginPath();y1<=b;){f++;d.moveTo(0,y1);d.lineTo(c,y1);for(x0=
f&1?u:u/2;x0<c;)d.moveTo(x0,y0),d.lineTo(x0,y1),x0+=u;y0=y1;y1+=e}d.stroke();Oa(a)}function Oa(a){var c=a.A,b=a.n,f=a.o;c&15&&(d.strokeStyle=a.v,d.beginPath(),c&1&&(d.moveTo(0,0),d.lineTo(b,0)),c&2&&(d.moveTo(b,0),d.lineTo(b,f)),c&4&&(d.moveTo(b,f),d.lineTo(0,f)),c&8&&(d.moveTo(0,f),d.lineTo(0,0)),d.stroke())}function Pa(a,c,b,f,u){var d=[],e=c+f,g=b+u;x(a,function(a){a.b+a.k>=c&&a.b<=e&&a.c+a.j-a.d/2>=b&&a.c-a.d/2<=g&&d.push(a)});return d}function gb(a){var c=M.indexOf(a.id);-1!=c?c<M.length-1&&
(M.splice(c,1),M.push(a.id)):(M.length>=Qa&&(c=M.shift(),za("Removing from cache cube "+c),delete Aa[c]),M.push(a.id),c=U(a.k,a.j,function(b){var c=d;d=b;a.Z(a);d=c}),za("Adding to cache cube "+a.id+"  X:"+a.x+" Y:"+a.y+" Z:"+a.z+" W:"+a.h+" H:"+a.f+" D:"+a.d),Aa[a.id]=c);Aa[a.id].g(a.b,a.c-a.d/2,a.k,a.j)}function hb(a){a.F&&(d.setTransform(1,0,0,1,0,a.d/2),a.F.g(a.F));a.top&&(d.setTransform(1,0,-0.5,0.5,0.4+a.d/2,0),a.top.g(a.top));a.right&&(d.setTransform(0.5,-0.5,0,1,a.h,a.d/2),a.right.g(a.right))}
function ua(a,c,b,f){var u={z:-1E10};x(Ra,function(d){d.z>u.z&&b+f>d.z&&a+f>d.x&&a<d.x+d.h&&c+f>d.y&&c<d.y+d.d&&(u=d)});return u}function ta(a,c,b,f,d){return ib(d,function(d){if(a+f>d.x&&a<d.x+d.h&&c+f>d.y&&c<d.y+d.d&&b+f>d.z&&b<d.z+d.f)return d})}function n(a,c,b,f){BH=BH||0.3*BW;var d={x:a,y:Y,z:c,h:b,f:f,d:h,k:b+h/2,j:f+h/2,Z:hb,g:gb};w(d);0<b&&0<f&&(d.F={C:jb,D:kb,I:lb,n:b,o:f,B:BW,w:BH,v:BC,A:B,g:DR[0]||DR});0<h&&0<f&&(d.right={C:mb,D:nb,I:ob,n:h,o:f,B:BW,w:BH,v:BC,A:B>>4,g:DR[1]||DR});0<b&&
0<h&&(d.top={C:pb,D:qb,I:rb,n:b,o:h,B:BW,w:BH,v:BC,A:B>>8,g:DR[2]||DR});d.id=sb++;T.push(d);Y+h<IPY||Y>IPY||(16<h&&16<f&&(va.push({y:Y,z:c,d:h,f:f,h:0,x:a}),wa.push({y:Y,z:c,d:h,f:f,h:0,x:a+b})),16<h&&16<b&&(Ra.push({x:a,y:Y,h:b,d:h,f:0,z:c+f}),Ja.push({x:a,y:Y,h:b,d:h,f:0,z:c})))}function w(a){a.b=a.x+a.y/2;a.c=m-a.y/2-a.f-a.z}function Ba(a){var c=d.createPattern(U(3*h,3*h,function(b){b.drawImage(a,0,0,3*h,3*h)}),"repeat");c.g=function(a,c,e,g){d.fillStyle=this;d.fillRect(a,c,e,g)};return c}function Ca(a,
c,b,f,d,e,g,h,p){c=a.createImageData(c,b);b=c.data;for(var q=0;q<b.length;q+=4){var n=b,m=q,tb=f+da()*d,s=e+da()*g,l=h+da()*p;n[m]=tb;n[m+1]=s;n[m+2]=l;n[m+3]=255}a.putImageData(c,0,0)}function g(a,c){var b=IPY,f;f=0+100*da();b={x:a,z:c,y:b,f:10,Q:f<<0};w(b);N.push(b)}function ub(){var a,c;for(c=0;c<N.length;c++)a=N[c],a.b>=e.b&&a.b<e.b+D&&a.c>=e.c&&a.c<e.c+D?(180<t-ba&&(E=0),N.splice(c,1),c--,K[E++].play(),E%=K.length,ba=t):d.drawImage(Da[(t+a.Q)%Da.length],a.b-O/2,a.c-O/2)}function P(a){Ea.p.V(a);
var c=Ea.X();a=new Uint8Array(4*((c+1)/2|0)+44);var c=2*Ea.W(new Uint16Array(a.buffer,44),c),b=new Uint32Array(a.buffer,0,44);b[0]=1179011410;b[1]=c+36;b[2]=1163280727;b[3]=544501094;b[4]=16;b[5]=65537;b[6]=44100;b[7]=88200;b[8]=1048578;b[9]=1635017060;b[10]=c;for(var c=c+44,b=0,f="data:audio/wav;base64,";b<c;b+=3)var d=a[b]<<16|a[b+1]<<8|a[b+2],f=f+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d>>12&63]+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d&63]);b-=c;a=new Audio;a.src=f.slice(0,f.length-b)+"==".slice(0,b);return a}function za(a){DEBUG||alert("Forgot a log");console.log(a)}function Sa(a,c){for(var b=[],f=0;f<a.length;f++)b[f]=a[f];for(k in c)b[k]=c[k];return b}function ea(a,c,b,f){return"rgba("+a+","+c+","+b+","+(f||1)+")"}function U(a,c,b){var f=fa.createElement("canvas");f.width=a;f.height=
c;b(f.getContext("2d"),f);f.g=function(a,b,c,f){d.drawImage(this,a,b,c,f)};return f}function ib(a,c){return vb(a.length,function(b){return c(a[b],b)})}function vb(a,c){var b;b=b||1;for(var f=0;f<a;f+=b){var d=c(f);if(d)return d}}function Fa(a,c){var b;b=b||1;for(var f=0;f<a;f+=b)c(f)}function x(a,c){for(var b=0;b<a.length;b++)c(a[b],b)}function wb(){this.V=function(a){for(var c=0;24>c;c++)this[String.fromCharCode(97+c)]=a[c]||0;0.01>this.m&&(this.m=0.01);a=this.q+this.m+this.r;0.18>a&&(a=0.18/a,this.q*=
a,this.m*=a,this.r*=a)}}function Ta(){t++;V=0.9*V+0.1*ha;J=Ua(V);Q=0.9*Q+0.1*S;OffsetY=Ua(Q);d.setTransform(1,0,0,1,0-J,0-OffsetY);d.clearRect(J,OffsetY,p,m);var a=Pa(T,J-p/2,OffsetY-m/2,2*p,2*m);e.update(e);x(a,function(a){a.update&&a.update(a)});Ga=Pa(a,J,OffsetY,p,m);DEBUG&&Ga.length>Qa&&za("too many sprites in screen to fit in cache");var c=[],b=[];x(Ga,function(a){var d;e.y+e.d<=a.y+3||a.z+a.f<=e.z+3||a.x+a.h<=e.x+3?d=!0:a.y+a.d<=e.y+3||e.z+e.f<=a.z+3||e.x+e.h<=a.x+3?d=!1:(console.log("cubes intersection: ",
a,e),d=null);d?c.push(a):b.push(a)});x(c,function(a){a.g(a)});e.g();x(b,function(a){d.globalAlpha=a.b-10<e.b+e.k&&a.b+10+a.k>e.b&&a.y+a.d<e.y&&a.c-10<e.c+e.j&&a.c+10+a.j>e.c?0.3:1;a.g(a)});d.globalAlpha=1;ub();ia(Ta)}DEBUG=!0;onerror=function(a,c,b){alert(a,c,b)};var fa=document,A=[];x(["b","c","d"],function(a){A.push(fa.getElementById(a))});var p=A[0].width,m=A[0].height,Va=A[1].getContext("2d"),d=Va,Wa=A[0].getContext("2d"),q=A[2].getContext("2d"),da=Math.random,aa=Math.abs,ra=Math.min,sa=Math.max,
Ua=Math.round,C=2*Math.PI,N=[],T=[],s=0,x=function(a,c){for(var b=0;b<a.length;b++)c(a[b],b)},ia=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame;if(!ia)var Xa=0,ia=function(a){var c=(new Date).getTime(),b=Math.max(0,16-(c-Xa));window.setTimeout(function(){a()},b);Xa=c+b};var V,Q,J=OffsetY=0,Ya=ea(15,15,15,0.3);BW=27;BH=0;B=4095;BC=Ya;var Ea=new function(){this.p=new wb;var a,c,b,d,e,g,h,p,q,n,m,s;this.reset=function(){var a=this.p;d=100/(a.T*a.T+0.001);
e=100/(a.J*a.J+0.001);g=1-0.01*a.f*a.f*a.f;h=1E-6*-a.K*a.K*a.K;a.S||(m=0.5-a.aa/2,s=5E-5*-a.ba);p=0<a.t?1-0.9*a.t*a.t:1+10*a.t*a.t;q=0;n=1==a.L?0:2E4*(1-a.L)*(1-a.L)+32};this.X=function(){this.reset();var d=this.p;a=1E5*d.q*d.q;c=1E5*d.m*d.m;b=1E5*d.r*d.r+10;return a+c+b|0};this.W=function(x,z){var l=this.p,A=1!=l.u||l.R,w=0.1*l.R*l.R,C=1+3E-4*l.h,v=0.1*l.u*l.u*l.u,E=1+1E-4*l.Q,G=1!=l.u,J=l.x*l.x,M=l.J,I=l.G||l.H,R=0.2*l.H*l.H*l.H,D=l.G*l.G*(0>l.G?-1020:1020),K=l.P?(2E4*(1-l.P)*(1-l.P)|0)+32:0,U=
l.d,O=l.$/2,ca=0.01*l.U*l.U,N=l.S,P=a,ea=1/a,fa=1/c,ha=1/b,l=5/(1+20*l.Y*l.Y)*(0.01+v);0.8<l&&(l=0.8);for(var l=1-l,S=!1,ba=0,la=0,ma=0,L=0,ja=0,na,ka=0,y,W=0,ga,T=0,r,da=0,$,V=0,Q=Array(1024),oa=Array(32),F=Q.length;F--;)Q[F]=0;for(F=oa.length;F--;)oa[F]=2*Math.random()-1;for(F=0;F<z;F++){if(S)return F;K&&++da>=K&&(da=0,this.reset());n&&++q>=n&&(n=0,d*=p);g+=h;d*=g;d>e&&(d=e,0<M&&(S=!0));y=d;0<O&&(V+=ca,y*=1+Math.sin(V)*O);y|=0;8>y&&(y=8);N||(m+=s,0>m?m=0:0.5<m&&(m=0.5));if(++la>P)switch(la=0,++ba){case 1:P=
c;break;case 2:P=b}switch(ba){case 0:ma=la*ea;break;case 1:ma=1+2*(1-la*fa)*U;break;case 2:ma=1-la*ha;break;case 3:ma=0,S=!0}I&&(D+=R,ga=D|0,0>ga?ga=-ga:1023<ga&&(ga=1023));A&&C&&(w*=C,1E-5>w?w=1E-5:0.1<w&&(w=0.1));$=0;for(var ia=8;ia--;){W++;if(W>=y&&(W%=y,3==N))for(na=oa.length;na--;)oa[na]=2*Math.random()-1;switch(N){case 0:r=W/y<m?0.5:-0.5;break;case 1:r=1-2*(W/y);break;case 2:r=W/y;r=6.28318531*(0.5<r?r-1:r);r=0>r?1.27323954*r+0.405284735*r*r:1.27323954*r-0.405284735*r*r;r+=0.225*(r*aa(r)-r);
break;case 3:r=oa[Math.abs(32*W/y|0)]}A&&(na=ka,v*=E,0>v?v=0:0.1<v&&(v=0.1),G?(ja+=(r-ka)*v,ja*=l):(ka=r,ja=0),ka+=ja,L+=ka-na,r=L*=1-w);I&&(Q[T%1024]=r,r+=Q[(T-ga+1024)%1024],T++);$+=r}$=0.125*$*ma*J;x[F]=1<=$?32767:-1>=$?-32768:32767*$|0}return z}},Za=[0,,0.14,0.445,0.4616,0.6,,,,,,0.587,0.5406,,,,,,1,,,,,0.45],K=[];Fa(5,function(a){K.push(P(Sa(Za,{5:0.6+0.05*a})))});Fa(4,function(a){K.push(P(Sa(Za,{5:0.8-0.05*a})))});var E=0,ba=0,O=80,Da=[];Fa(128,function(a){var c=aa(Math.sin(C*a/128));0.1<c&&
Da.push(U(O,O,function(b){b.strokeStyle="#aa6";b.shadowBlur=30;b.lineWidth=2;b.shadowColor="#ff2";b.beginPath();b.setTransform(c,0,0,1,O/2,O/2);b.fillStyle="#fe4";b.arc(0,0,10,0,C);b.fill();b.fillStyle="#aa6";63<a?b.fillText("1",-3,3.5):b.fillText("\u265b",-5,3.5);b.stroke()}))});var h=20,xb=U(h,h,function(a){Ca(a,h,h,80,20,180,40,80,40)}),yb=U(h,h,function(a){Ca(a,h,h,120,20,110,20,40,30)}),zb=U(h,h,function(a){Ca(a,h,h,140,25,120,25,50,40)}),rb=Ba(xb),lb=Ba(yb),ob=Ba(zb),ha=0,S=0,va=[],wa=[],Ra=
[],Ja=[],Aa={},M=[],sb=0,Qa=50,pb="#e86",qb="#eda",jb="#d74",kb="#dc8",mb="#b52",nb="#ba6",xa=d.createRadialGradient(15,-9,3,15,-9,32);xa.addColorStop(0,"#FFD6CE");xa.addColorStop(1,"#B34C80");var v=22,L=2*v,z=L/4;PY=IPY=50;Y=0;BW=27;BC=Ya;DR=ca;h=100;Y=90;h=10;DR=ca;B=4095;n(299,-400,20,125);n(661,-479,20,121);n(332,-478,20,58);n(1480,-389,20,84);Y=0;h=100;DR=ya;n(80,-514,614,34);B=4091;n(449,-482,141,71);DR=ca;B=4095;n(187,-248,174,16);IPX=137;IPZ=-424;g(208,-193);g(260,-210);g(315,-190);Y=0;n(217,
-412,141,12);g(589,-382);Na(547,-381);Y=0;n(391,-342,141,28);DR=ya;n(770,-543,462,34);DR=ca;n(802,-416,111,28);n(914,-509,171,219);n(627,-326,150,12);g(798,-463);g(850,-480);g(836,-446);g(882,-486);g(819,-480);g(872,-460);g(1132,-320);g(1184,-322);g(1236,-323);g(1184,-350);g(1160,-322);g(1211,-323);g(1185,-374);g(1186,-398);g(1188,-422);g(1177,-446);g(1152,-451);g(1134,-431);DR=ya;Y=0;n(1279,-543,259,42);g(1313,-335);g(1364,-311);g(994,-205);g(1316,-362);g(1336,-315);g(1386,-328);g(1338,-386);g(1360,
-403);g(1379,-431);g(1361,-452);g(1330,-456);g(1304,-437);Na(1022,-247);Y=0;n(1430,-501,141,110);DR=ca;n(1404,-293,111,28);n(1185,-240,168,28);n(1544,-391,53,65);g(1231,-122);g(1232,-147);g(1233,-171);g(1233,-194);g(1278,-97);g(1335,-103);g(1307,-98);g(1297,-144);g(1318,-130);g(1324,-195);g(1339,-171);g(1324,-156);g(1298,-200);g(1273,-187);g(1231,-97);Y=0;h=10;B=234;n(246,-482,50,70);B=4095;n(476,-411,27,70);n(1441,-391,20,97);var G={32:0};fa.addEventListener("keydown",function(a){G[a.keyCode]=1;
e.left=G[37];e.right=G[39];e.s=G[32]});fa.addEventListener("keyup",function(a){G[a.keyCode]=0;e.left=G[37];e.right=G[39];e.s=G[32]});fa.body.addEventListener("touchmove",function(a){a.preventDefault()},!1);q.fillStyle=ea(140,150,240,0.5);q.shadowColor=ea(170,180,250,0.5);q.shadowBlur=30;q.lineWidth=7;q.strokeStyle=ea(80,90,140,0.5);var I=A[2];I.addEventListener("touchstart",function(a){var c=null,b=null;x(a.changedTouches,function(a){var d=a.clientX-I.offsetLeft,e=a.clientY-I.offsetTop;d<p/2-20?c=
[a.identifier,d,e]:d>p/2+20&&(b=[a.identifier,d,e])});null!=c&&Ma(c);null!=b&&La(b)});I.addEventListener("touchmove",function(a){var c=null,b=null;x(a.changedTouches,function(a){var d=a.clientX-I.offsetLeft,e=a.clientY-I.offsetTop;d<p/2-20?c=[a.identifier,d,e]:d>p/2+20&&(b=[a.identifier,d,e])});null!=c&&Ma(c);null!=b&&La(b)});I.addEventListener("touchend",function(a){x(a.changedTouches,function(a){null!=s.move&&a.identifier==s.move[0]&&(s.move=null,e.left=0,e.right=0,q.beginPath(),q.clearRect(0,0,
p/2,m),q.arc(s.x,s.y,30,0,C),q.fill());null!=s.button&&a.identifier==s.button[0]&&(s.button=null,e.s=0,q.clearRect(p/2,0,p/2,m))})});var qa=d.createRadialGradient(12,-7,3,12,-7,28);qa.addColorStop(0,"#8ED6FF");qa.addColorStop(1,"#004CB3");var D=40,R=D/4,cb=P([0,,0.1453,,0.225,0.3726,,0.12,0.22,,,,,0.1547,,,,,1,,,,,0.35]),db=P([0,,0.1,,0.22,0.3726,,0.14,0.2,,,,0.12,0.1547,,,,,1,,,,,0.26]),Ka=P([0,,0.11,0.16,0.09,0.227,0.04,-0.18,0.34,,,,,0.23,0.12,,,,1,0.2,0.16,0.1,,0.32]),bb=ea(15,15,15,0.5),e={};
pa();V=ha=e.b-0.5*p;Q=S=e.c-0.8*m;Ha();onresize=function(){var a=A[0].parentElement,c=p,b=m;p=ra(960,a.offsetWidth);m=ra(760,a.offsetHeight);var d=a.offsetTop+(a.offsetHeight-m)/2+"px",e=a.offsetLeft+(a.offsetWidth-p)/2+"px";x(A,function(a){a.style.top=d;a.style.left=e;if(c!=p||b!=m)a.width=p,a.height=m});Wa.fillStyle="#222";Wa.fillRect(0,0,p,m);if(c!=p||b!=m)x(N,function(a){w(a)}),x(T,function(a){w(a)}),Ha()};onresize();d=Va;t=0;var Ga=[];ia(Ta)})();
